- name: Install apt-utils to avoid debconf warnings
  ansible.builtin.apt:
    name: apt-utils
    state: present
    update_cache: true
    install_recommends: false

- name: Update Packages
  apt:
    force_apt_get: yes
    update_cache: true
    upgrade: yes
    state: latest
  register: packages
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ packages }}"

- name: Ensure snapd
  apt:
    force_apt_get: yes
    name: 
      - snapd
  register: snapd
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ snapd }}"

- name: Ensure snapd service is running
  service:
    name: snapd
    state: started
    enabled: true
  delegate_to: "{{ ansible_host }}"

- name: Ensure MicroK8s
  snap: 
    name: 
      - microk8s
    classic: yes
  delegate_to: "{{ ansible_host }}"
