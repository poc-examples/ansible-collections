- name: Enable Docker Repository
  ansible.builtin.yum_repository:
    name: docker
    description: Docker CE Stable Repository
    baseurl: https://download.docker.com/linux/fedora/41/x86_64/stable
    gpgcheck: yes
    gpgkey: https://download.docker.com/linux/fedora/gpg
    enabled: yes

- name: Update System Packages
  ansible.builtin.yum:
    name: "*"
    state: latest

- name: Install Required Packages
  ansible.builtin.yum:
    name:
      - jq
      - curl
      - wget
      - apt-transport-https
      - containerd.io
      - docker-ce
      - docker-ce-cli
      - docker-buildx-plugin
    state: latest

- name: Start Docker Service
  ansible.builtin.service:
    name: docker
    state: started
    enabled: true

# - name: Ensure Groups
#   ansible.builtin.group:
#     name: docker
#     state: present

# - name: Add vagrant user to the docker group
#   ansible.builtin.user:
#     name: vagrant
#     groups: docker
#     append: true

# - name: start k3s
#   ansible.builtin.command:
#     cmd: "curl -sfL https://get.k3s.io | sh -"
#   args:
#     creates: /usr/local/bin/k3s

# - name: Start Libvirtd Service
#   ansible.builtin.service:
#     name: libvirtd
#     state: started
#     enabled: true

# - name: Create Storage Pool
#   block:

#     - name: Ensure Directory
#       ansible.builtin.file:
#         path: "/var/lib/libvirt/storage/cockpit_pool"
#         state: directory
#         mode: '0755'

#     - name: Create a new logical volume
#       community.general.lvol:
#         vg: "fedora_k8s"
#         lv: "openshift"
#         size: "500G"

#     - name: Define Storage Pool
#       community.libvirt.virt_pool:
#         command: define
#         name: local-machines
#         autostart: true
#         xml: |
#           <pool type='logical'>
#             <name>local-machines</name>
#             <source>
#               <name>fedora_k8s</name>
#             </source>
#             <target>
#               <path>/dev/fedora_k8s</path>
#             </target>
#           </pool>

#     - name: Enable Storage Pool
#       community.libvirt.virt_pool:
#         name: local-machines
#         state: active
#         autostart: true

