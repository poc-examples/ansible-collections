# - name: Install apt-utils to avoid debconf warnings
#   ansible.builtin.apt:
#     name: apt-utils
#     state: present
#     update_cache: true
#     install_recommends: false

- name: Update Packages
  ansible.builtin.apt:
    update_cache: true
    upgrade: yes
    state: latest
  register: packages
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ packages }}"

- name: Ensure Snapd
  ansible.builtin.apt:
    name: snapd
    state: latest
  register: snapd
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ snapd }}"

- name: Enable Snapd Service
  ansible.builtin.service:
    name: snapd
    state: started
    enabled: true
  register: service
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ service }}"

- name: Ensure MicroK8s
  community.general.snap: 
    name: microk8s
    classic: true
  register: microk8s
  delegate_to: "{{ ansible_host }}"
- debug:
    msg: "{{ microk8s }}"
